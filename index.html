<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<title>Universal Web Device Terminal</title>
<style>
body {
  background:#0b0f1a;
  color:#00ff9c;
  font-family:monospace;
  padding:20px;
}
#terminal {
  background:black;
  height:400px;
  overflow:auto;
  padding:10px;
  border:1px solid #00ff9c;
  white-space:pre-wrap;
}
button,input {
  background:#111;
  color:#00ff9c;
  border:1px solid #00ff9c;
  padding:6px;
}
</style>
</head>
<body>

<h2>Universal Web Device Terminal</h2>
<button onclick="connect()">Yhdistä laite</button>
<div id="terminal"></div>
<input id="input" placeholder="lähetä dataa">

<script>
const term = document.getElementById("terminal");
const log = t => {
  term.textContent += t + "\n";
  term.scrollTop = term.scrollHeight;
};

async function connect() {
  // 1️⃣ WEB SERIAL (Arduino, COM, ESP, jne.)
  if ("serial" in navigator) {
    try {
      const port = await navigator.serial.requestPort();
      await port.open({ baudRate: 9600 });
      log("✅ Web Serial käytössä");

      const reader = port.readable.getReader();
      const writer = port.writable.getWriter();

      document.getElementById("input").onkeydown = async e => {
        if (e.key === "Enter") {
          await writer.write(new TextEncoder().encode(e.target.value + "\n"));
          e.target.value = "";
        }
      };

      while (true) {
        const { value } = await reader.read();
        log(new TextDecoder().decode(value));
      }
    } catch {}
  }

  // 2️⃣ WEB USB
  if ("usb" in navigator) {
    try {
      const dev = await navigator.usb.requestDevice({ filters: [] });
      await dev.open();
      log("⚠ WebUSB-laite (vain jos firmware tukee)");
      return;
    } catch {}
  }

  // 3️⃣ WEB HID
  if ("hid" in navigator) {
    try {
      const [dev] = await navigator.hid.requestDevice({ filters: [] });
      await dev.open();
      log("⚠ WebHID-laite");
      dev.oninputreport = e => {
        log("HID: " + [...e.data.buffer].join(" "));
      };
      return;
    } catch {}
  }

  log("❌ Laitetta ei voi käyttää selaimessa");
}
</script>

</body>
</html>
